
```{r}
# 1.ÇÊ¿ä ¶óÀÌºê·¯¸® ºÒ·¯¿À±â
library(KoNLP)
library(wordcloud)

# 2.ÆÄÀÏ ºÒ·¯¿À±â
advice<- read.csv("c:/r/advice.csv",stringsAsFactors=F)
advice

# 3-1. SimplePos09ÀÌ¿ëÇÏ¿© Á¶°¢³»°í /NÀ¸·Î ¸í»çÇü Ã£¾Æ³»±â
sample<- SimplePos09(advice$CONTENTS)
sample
str_match(sample, '([A-z°¡-ÆR]+)/N')

# 3-2. extractNounÀ¸·Î Á¶°¢³»°í unlist, tableÇÔ¼ö »ç¿ëÇÏ¿© Å×ÀÌºí Çü½ÄÀ¸·Î Á¤¸®
sample2<- extractNoun(advice$CONTENTS)

sample2<- unlist(sample2)
sample2<- table(sample2)

# 4. wordcloudÇÏ±â
wordcloud2(sample2)


```
[¹®Á¦244]advice.csv ÆÄÀÏ¿¡ ÀÖ´Â µ¥ÀÌÅÍ¸¦ ºĞ¼® ÇÏ¼¼¿ä.

# 1.ÇÊ¿ä ¶óÀÌºê·¯¸® ºÒ·¯¿À±â
library(KoNLP)
library(wordcloud)

# 2.ÆÄÀÏ ºÒ·¯¿À±â
advice<- read.csv("c:/r/advice.csv",stringsAsFactors=F)
advice

# 3-1. SimplePos09ÀÌ¿ëÇÏ¿© Á¶°¢³»°í /NÀ¸·Î ¸í»çÇü Ã£¾Æ³»±â
sample<- SimplePos09(advice$CONTENTS)
sample
str_match(sample, '([A-z°¡-ÆR]+)/N')

# 3-2. extractNounÀ¸·Î Á¶°¢³»°í unlist, tableÇÔ¼ö »ç¿ëÇÏ¿© Å×ÀÌºí Çü½ÄÀ¸·Î Á¤¸®
sample2<- extractNoun(advice$CONTENTS)

sample2<- unlist(sample2)
sample2<- table(sample2)

# 4. wordcloudÇÏ±â
wordcloud2(sample2)

```{r}
library(wordcloud)

advice<- read.csv("c:/r/advice.csv",stringsAsFactors=F)
advice



noun1<- unlist(extractNoun(advice$CONTENTS))
noun2<- unlist(sapply(advice$CONTENTS, extractNoun,USE.NAMES = F))


#È¯ºÒ°ü·ÃµÈ ´Ü¾îµéÀ» 'È¯ºÒ'·Î ÅëÀÏ
# 1. noun1[str_match(noun1,'(È¯ºÒ+)')[,1]=='È¯ºÒ']<- "È¯ºÒ"
# 2.
noun1[str_detect(noun1,"È¯ºÒ")]<- "È¯ºÒ"

word_cn1<- table(noun1)
word_cn2<- table(noun2)

sort(word_cn1, decreasing = T)
a<- head(sort(word_cn1, decreasing = T),10)

a<- a[a>1]  # 1°³ ÀÌ»óÀÇ ´Ü¾î¸¸ Ãâ·Â
a<- a[-5]  # '¾Èµé¸²'ÀÌ¶ó´Â ´Ü¾î´Â »©±â
a

# ¸ÅÆ®¸¯½º Çü¼º
x<- matrix(data = NA, nrow = length(advice$DATE), ncol=length(names(a)))

# ¿­ÀÌ¸§ ÇàÀÌ¸§ »ğÀÔ
colnames(x)<- names(a)
rownames(x)<- advice$DATE


# 1. str_match_allÀ» ÀÌ¿ëÇÏ¿© ¸Â´Â ´Ü¾î°¡ ÀÖÀ» °æ¿ì °¹¼ö¸¦ ¼¼¾Ë·Á¼­ ÀÔ·Â
for(i in 1:length(advice$CONTENTS)){
  for(j in 1:length(names(a))){
    x[i,j]<- length(unlist(str_match_all(advice$CONTENTS[i],names(a)[j])[!is.na(str_match(advice$CONTENTS[i],names(a)[j]))]))

  }
}

#2. str_matchÀ» ÀÌ¿ëÇÏ¿© ¸Â´Â ´Ü¾î°¡ ÀÖÀ» °æ¿ì 1, ¾øÀ¸¸é 0À» ÀÔ·Â
for(i in 1:length(advice$CONTENTS)){
  for(j in 1:length(names(a))){
    x[i,j]<- length(str_match(advice$CONTENTS[i],names(a)[j])[!is.na(str_match(advice$CONTENTS[i],names(a)[j]))])

  }
}
x


rules1 <- apriori(x, parameter=list(supp = 0.2, conf = 0.6, target = "rules")) # ¸ÅÆ®¸¯½º Çü½ÄÀ¸·Î Áı¾î³Ö¾î¾ß ÇÔ.(Æ®·£Á§¼Ç ¸ğ¾çÀ¸·Î ³Ö¾î¾ßÇÔ.)

rules1

inspect(sort(rules1)) # apriori¿Í inspect´Â ÇÑ½Ö

b2<- t(x) %*% x # 

diag(b2) # ´ë°¢ Çà·Ä

b3<- b2 - diag(diag(b2)) # ÀÚ±âÀÚ½Å°úÀÇ °ü°è´Â ÇÊ¿ä¾øÀ¸¹Ç·Î »©±âÀ§ÇØ¼­

#install.packages("sna") # ³×Æ®¿öÅ© ±×·¡ÇÁ ±×¸®±âÀ§ÇÑ ¼³Ä¡ (¿¬°ü¼ºÀ» º¸¿©ÁÖ±â À§ÇØ¼­)
#install.packages("rgl")
library(sna)
library(rgl)

gplot(b3,
      displaylabel = T, # ³ëµå ·¹ÀÌºíÀ» Ç¥½Ã
      vertex.cex=sqrt(diag(b2)), #³ëµå Å©±â
      vertex.col = "green", # ³ëµå »ö»ó 
      edge.col = "blue", # ¼±ÀÇ »ö
      boxed.labels = F, # ³ëµå·¹ÀÌºí¿¡ ¹Ú½º
      arrowhead.cex = 0.3, # È­»ìÃËÀÇ ¹è¼ö
      label.pos = 3, # ³ëµå ·¹ÀÌºí À§Ä¡ 0~5
      edge.lwd = b3, # ¼±ÀÇ ÆøÁöÁ¤ ¹è¼ö
      label.cex = 0.7) # ±ÛÀÚ Å©±â 
```

```{r}
[¹®Á¦245] ¹®Á¦244¹øÀÇ °á°ú ´Ü¾îµéÀ» °¡Áö°í ¾Æ·¡Ã³·³ ¸¸µé¾î º¸¼¼¿ä.


È¯ºÒ   ±âºĞ   Æ÷Àå   ¼±¹° ÀÌ¾îÆù   Á¤Ç° ÁöÀúºĞ È­ÀåÇ° 
10      5      3      2      2      2      2      2 



             È¯ºÒ ±âºĞ Æ÷Àå ¼±¹° ÀÌ¾îÆù Á¤Ç° ÁöÀúºĞ È­ÀåÇ°
2017-01-10    0    0    1    0      0    0      1      0
2017-01-11    1    0    0    0      0    0      0      1
2017-01-12    1    0    0    0      1    1      0      0
2017-01-13    1    0    0    0      0    1      0      0
2017-01-14    1    1    0    0      0    0      0      0
2017-01-15    1    1    0    0      0    0      0      0
2017-01-16    1    0    0    0      1    0      0      0
2017-01-17    1    1    1    1      0    0      0      0
2017-01-18    1    1    0    0      0    0      0      0
2017-01-19    1    0    0    0      0    0      0      0
2017-01-20    1    1    1    1      0    0      1      0


library(wordcloud)

advice<- read.csv("c:/r/advice.csv",stringsAsFactors=F)
advice



noun1<- unlist(extractNoun(advice$CONTENTS))
noun2<- unlist(sapply(advice$CONTENTS, extractNoun,USE.NAMES = F))


#È¯ºÒ °ü·ÃµÈ ´Ü¾îµéÀ» 'È¯ºÒ'·Î ÅëÀÏ
# 1. noun1[str_match(noun1,'(È¯ºÒ+)')[,1]=='È¯ºÒ']<- "È¯ºÒ"
# 2.
noun1[str_detect(noun1,"È¯ºÒ")]<- "È¯ºÒ"

word_cn1<- table(noun1)
word_cn2<- table(noun2)

sort(word_cn1, decreasing = T)
a<- head(sort(word_cn1, decreasing = T),10)

a<- a[a>1]  # 1°³ ÀÌ»óÀÇ ´Ü¾î¸¸ Ãâ·Â
a<- a[-5]  # '¾Èµé¸²'ÀÌ¶ó´Â ´Ü¾î´Â »©±â
a

# ¸ÅÆ®¸¯½º Çü¼º
x<- matrix(data = NA, nrow = length(advice$DATE), ncol=length(names(a)))

# ¿­ÀÌ¸§ ÇàÀÌ¸§ »ğÀÔ
colnames(x)<- names(a)
rownames(x)<- advice$DATE


# 1. str_match_allÀ» ÀÌ¿ëÇÏ¿© ¸Â´Â ´Ü¾î°¡ ÀÖÀ» °æ¿ì °¹¼ö¸¦ ¼¼¾Ë·Á¼­ ÀÔ·Â
for(i in 1:length(advice$CONTENTS)){
  for(j in 1:length(names(a))){
    x[i,j]<- length(unlist(str_match_all(advice$CONTENTS[i],names(a)[j])[!is.na(str_match(advice$CONTENTS[i],names(a)[j]))]))

  }
}

#2. str_matchÀ» ÀÌ¿ëÇÏ¿© ¸Â´Â ´Ü¾î°¡ ÀÖÀ» °æ¿ì 1, ¾øÀ¸¸é 0À» ÀÔ·Â
for(i in 1:length(advice$CONTENTS)){
  for(j in 1:length(names(a))){
    x[i,j]<- length(str_match(advice$CONTENTS[i],names(a)[j])[!is.na(str_match(advice$CONTENTS[i],names(a)[j]))])

  }
}
x


rules1 <- apriori(x, parameter=list(supp = 0.2, conf = 0.6, target = "rules")) # ¸ÅÆ®¸¯½º Çü½ÄÀ¸·Î Áı¾î³Ö¾î¾ß ÇÔ.(Æ®·£Á§¼Ç ¸ğ¾çÀ¸·Î ³Ö¾î¾ßÇÔ.)

rules1

inspect(sort(rules1)) # apriori¿Í inspect´Â ÇÑ½Ö

b2<- t(x) %*% x # 

diag(b2) # ´ë°¢ Çà·Ä

b3<- b2 - diag(diag(b2)) # ÀÚ±âÀÚ½Å°úÀÇ °ü°è´Â ÇÊ¿ä¾øÀ¸¹Ç·Î »©±âÀ§ÇØ¼­

#install.packages("sna") # ³×Æ®¿öÅ© ±×·¡ÇÁ ±×¸®±âÀ§ÇÑ ¼³Ä¡ (¿¬°ü¼ºÀ» º¸¿©ÁÖ±â À§ÇØ¼­)
#install.packages("rgl")
library(sna)
library(rgl)

gplot(b3,
      displaylabel = T, # ³ëµå ·¹ÀÌºíÀ» Ç¥½Ã
      vertex.cex=sqrt(diag(b2)), #³ëµå Å©±â
      vertex.col = "green", # ³ëµå »ö»ó 
      edge.col = "blue", # ¼±ÀÇ »ö
      boxed.labels = F, # ³ëµå·¹ÀÌºí¿¡ ¹Ú½º
      arrowhead.cex = 0.3, # È­»ìÃËÀÇ ¹è¼ö
      label.pos = 3, # ³ëµå ·¹ÀÌºí À§Ä¡ 0~5
      edge.lwd = b3, # ¼±ÀÇ ÆøÁöÁ¤ ¹è¼ö
      label.cex = 0.7) # ±ÛÀÚ Å©±â 
```




```{r}

#¼±»ı´Ô ´ä¾È

library(KoNLP)
library(wordcloud2)

useSejongDic()

buildDictionary(ext_dic="woorimalsam",user_dic=data.frame("Å«¸¾¸Ô°í","ncn"),replace_usr_dic=F)
buildDictionary(ext_dic="woorimalsam",user_dic=data.frame("È¯ºÒ","ncn"),replace_usr_dic=F)
buildDictionary(ext_dic="woorimalsam",user_dic=data.frame("´çÀå","ncn"),replace_usr_dic=F)

advice <- read.csv("c:/r/advice.csv", header=T, stringsAsFactors=F)
str(advice)
text <- advice[,2]
text

text<-gsub('±â½º°¡','±â½º',text)
text<-gsub('Ã·¿¡¿ÔÀ»¶§µµ','Ã·¿¡ ¿ÔÀ»¶§µµ',text)
text<-gsub('ÇÔºÎ·Î´Ù·é°Íµµ¾Æ´Ï¿©¼­','ÇÔºÎ·Î ´Ù·é °Íµµ ¾Æ´Ï¿©¼­',text)
text<-gsub('Ã·¿¡¿ÔÀ»¶§µµ','Ã·¿¡ ¿ÔÀ»¶§µµ',text)
text<-gsub('È¯ºÒÇØÁÖ¼¼¿ä','È¯ºÒ ÇØÁÖ¼¼¿ä',text)
text<-gsub('´çÀå±ŞÇØ¼­','´çÀå ±ŞÇØ¼­',text)
text<-gsub('[^°¡-ÆR]',' ',text)
word<-extractNoun(text)   
word
word1<-unlist(word)
word1<-Filter(function(x){nchar(x)>=2},word1)    
word1
word2<-c()
for (i in word1){
  if (!i %in% c('¾Èµé','ÇÏ·Á','¾Æ´Ñ°¡ºÁ¿ä','ÀÖ´Â°Å','ÇØÁÖ')){
    word2<-c(word2,i)
  }
}

word2
word_cn<-table(word2) 
word_cn


library(wordcloud)
library(RColorBrewer)
wordcloud(names(word_cn),freq=word_cn,min.freq=1,scale=c(3,1),
          random.order=F,random.color =T,
          colors=brewer.pal(8,'Dark2'))

wordcloud2(word_cn, size = 1,shape='star')


word_sort<-sort(word_cn,decreasing=T)   
word_sort<-word_sort[word_sort>=2]   
word_sort
res_sort<-as.matrix(word_sort)
res_sort
keyword<-rownames(word_sort)
keyword


data<-c()
for (i in 1:length(word)){
  index<-intersect(word[[i]],keyword)
  data<-rbind(data,table(index)[keyword])
}
data


date <- advice[,1]
date

data<-ifelse(is.na(data),0,data)
data
colnames(data)<-keyword
rownames(data)<-date
data

res<-as.data.frame(data)
res
str(res)    

library(arules)
trans<-as.matrix(res,'Transaction')
res_rul<-apriori(trans, parameter = list(supp=0.4, conf = 0.9,  target = "rules"))


inspect(sort(res_rul,by='lift'))

lhs       rhs    support   confidence lift
[1] {±âºĞ} => {È¯ºÒ} 0.4545455 1.0000000  1.1 
[2] {}     => {È¯ºÒ} 0.9090909 0.9090909  1.0 


inspect(subset(res_rul,items %in% '±âºĞ'))
```



```{r}
#   ,  ·Î ±¸ºĞµÇ¾îÀÖ´Â ÆÄÀÏÀ» ºÒ·¯¿Ã¶§ read.transactions·Î ºÒ·¯¿À¸é ÆíÇÏ´Ù.
groceries<- read.transactions("c:/r/groceries.csv",sep=",")
groceries
summary(groceries)

inspect(groceries[1:5])

# Á¦Ç°ÀÌ Æ÷ÇÔÇÑ °Å·¡ÀÇ ºñÀ²
itemFrequency(groceries[,1:3])

itemFrequencyPlot(groceries,support = 0.1)

#topN ºĞ¼® !! sql °øºÎÇÏÀÚ
itemFrequencyPlot(groceries, topN = 20)

grocery_rules<- apriori(groceries,parameter = list(support = 0.006, confidence = 0.25, minlen = 2))

summary(grocery_rules)

inspect(grocery_rules)

# "berries"¸¸ º¸°í½Í´Ù.
inspect(subset(grocery_rules,items %in% "berries"))

inspect(sort(grocery_rules, by = "lift")[1:5])

# Á¤Á¦ ÀÛ¾÷ ÈÄ ÆÄÀÏ·Î ¶³±¸±â
write(grocery_rules, file = "c:/r/grocery_rules.csv", sep = ",", quote = T, row.names = F)

grocery_rules_df <- as(grocery_rules, "data.frame")

grocery_rules_df


grocery_rules_df[order(grocery_rules_df$lift,decreasing=T),]

# ¾÷ ¼¿¸µ = Á» ´õ ºñ½Î°í Å«°É ±ÇÇØ¼­ ÆÄ´Â °Í  (ex> 64GB Â¥¸® USB»ç·¯ ¿Â »ç¶÷ÇÑÅ×  1TBÂ¥¸® ±ÇÇØ¼­ ÆÄ´Â °Í)
# Å©·Î½º ¼¿¸µ = ·Ñ·¯½ºÄÉÀÌÆ® »ç·¯ ¿Â »ç¶÷¿¡°Ô º¸È£±¸±îÁö ¼¼Æ®·Î ¹­¾î¼­ ÆÇ¸ÅÇÏ´Â °Í
```

